{% comment -%}
The life and times of Dr John Dee
Copyright (C) 2021  Jordan Cole <feedback@drjohndee.net>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
{% endcomment -%}

{% assign source_record = include.source_key | collection_entry: "sources" -%}
{% if source_record -%}
  {% if include.volume -%}
  {% assign itemtype = "PublicationVolume" -%}
  {% else -%}
  {% assign itemtype = "CreativeWork" -%}
  {% endif -%}

  {% assign edition = source_record.editions | find: "edition_key", include.edition_key -%}
  <span itemtype="https://schema.org/{{ itemtype }} https://schema.org/{{ edition.type }}"
        itemid="{{ page.url | relative_url }}#source--{{ include.source_key | slugify }}">
    <meta itemprop=url content="{{ include.source_key | collection_entry_url: "sources" }}">
    <meta itemprop=pagination content="{{ include.location }}">

    {% if include.volume -%}
    <meta itemprop=volumeNumber content="{{ include.volume }}">
    {% endif -%}

    {% assign name = edition.name | default: source_record.work.name -%}
    <meta itemprop=name content="{{ name }}">
  </span>
{% endif -%}
